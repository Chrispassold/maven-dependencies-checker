<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador e Comparador de Dependências Maven</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'slide-up': 'slideUp 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gradient-to-br from-slate-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl" x-data="mavenDependencies()">
        <!-- Header -->
        <div class="text-center mb-8 animate-fade-in">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">
                <i class="fas fa-search text-blue-600 mr-3"></i>
                Buscador de Dependências Maven
            </h1>
            <p class="text-gray-600 text-lg">Extraia e compare dependências do Maven Repository</p>
        </div>

        <!-- Search Section -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8 animate-slide-up">
            <div class="flex flex-col lg:flex-row gap-4">
                <div class="flex-1">
                    <label for="mavenUrl" class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-link mr-2"></i>URL do Maven Repository
                    </label>
                    <input 
                        type="url" 
                        id="mavenUrl"
                        x-model="mavenUrl"
                        @keyup.enter="fetchDependencies()"
                        placeholder="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web/3.2.5"
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"
                        :class="{'border-red-500': mavenUrl && !isValidUrl(mavenUrl)}"
                    >
                </div>
                <div class="flex gap-2">
                    <button 
                        @click="fetchDependencies()"
                        :disabled="!mavenUrl || !isValidUrl(mavenUrl) || loading"
                        class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all duration-200 flex items-center gap-2"
                    >
                        <i class="fas fa-search" x-show="!loading"></i>
                        <i class="fas fa-spinner fa-spin" x-show="loading"></i>
                        <span x-text="loading ? 'Buscando...' : 'Buscar'"></span>
                    </button>
                    <button 
                        @click="clearResults()"
                        class="px-4 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-all duration-200"
                        title="Limpar resultados"
                    >
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div x-show="results" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0" class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-code mr-2 text-green-600"></i>JSON Gerado
                </h3>
                <div class="flex gap-2">
                    <button 
                        @click="copyToField('old')"
                        class="px-3 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-all duration-200 text-sm"
                        title="Copiar para JSON Antigo"
                    >
                        <i class="fas fa-arrow-left mr-1"></i>Antigo
                    </button>
                    <button 
                        @click="copyToField('new')"
                        class="px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all duration-200 text-sm"
                        title="Copiar para JSON Novo"
                    >
                        <i class="fas fa-arrow-right mr-1"></i>Novo
                    </button>
                    <button 
                        @click="copyToClipboard()"
                        class="px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-all duration-200 text-sm"
                        title="Copiar para área de transferência"
                    >
                        <i class="fas fa-copy mr-1"></i>Copiar
                    </button>
                </div>
            </div>
            <div class="bg-gray-900 rounded-lg p-4 overflow-x-auto">
                <pre class="text-green-400 text-sm"><code x-text="jsonOutput"></code></pre>
            </div>
        </div>

        <!-- Divider -->
        <div class="flex items-center justify-center my-8">
            <div class="flex-1 h-px bg-gray-300"></div>
            <div class="px-4 text-gray-500">
                <i class="fas fa-exchange-alt"></i>
            </div>
            <div class="flex-1 h-px bg-gray-300"></div>
        </div>

        <!-- Comparator Section -->
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
                <i class="fas fa-balance-scale mr-3 text-purple-600"></i>
                Comparador de Dependências
            </h2>
            
            <!-- JSON Inputs -->
            <div class="relative">
                <div class="grid lg:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="jsonOld" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-history mr-2 text-orange-500"></i>JSON Antigo (Versão 1)
                        </label>
                        <textarea 
                            id="jsonOld"
                            x-model="jsonOld"
                            rows="12"
                            placeholder="Cole o JSON da versão antiga aqui..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 font-mono text-sm"
                        ></textarea>
                    </div>
                    <div>
                        <label for="jsonNew" class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-rocket mr-2 text-green-500"></i>JSON Novo (Versão 2)
                        </label>
                        <textarea 
                            id="jsonNew"
                            x-model="jsonNew"
                            rows="12"
                            placeholder="Cole o JSON da versão nova aqui..."
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200 font-mono text-sm"
                        ></textarea>
                    </div>
                </div>
                
                <!-- Swap Button -->
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-10">
                    <button 
                        @click="swapJsons()"
                        class="bg-purple-600 hover:bg-purple-700 text-white rounded-full p-3 shadow-lg transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2"
                        title="Trocar JSONs"
                    >
                        <i class="fas fa-exchange-alt text-lg"></i>
                    </button>
                </div>
            </div>

            <!-- Filter Options -->
            <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-xl p-6 mb-6 border border-gray-200">
                <div class="flex items-center mb-4">
                    <i class="fas fa-sliders-h text-blue-600 mr-3 text-lg"></i>
                    <h4 class="text-lg font-semibold text-gray-800">Filtros de Visualização</h4>
                </div>
                
                <!-- Main Filters -->
                <div class="mb-6">
                    <h5 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-list-ul mr-2 text-gray-500"></i>Tipo de Mudança
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-blue-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showAdded" class="mr-3 rounded text-green-600 focus:ring-green-500">
                            <div class="flex items-center">
                                <i class="fas fa-plus-circle text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-green-700">Adições</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-red-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showRemoved" class="mr-3 rounded text-red-600 focus:ring-red-500">
                            <div class="flex items-center">
                                <i class="fas fa-minus-circle text-red-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-red-700">Remoções</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-yellow-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showChanged" class="mr-3 rounded text-yellow-600 focus:ring-yellow-500">
                            <div class="flex items-center">
                                <i class="fas fa-exchange-alt text-yellow-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-yellow-700">Modificações</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-purple-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showOnlyExisting" class="mr-3 rounded text-purple-600 focus:ring-purple-500">
                            <div class="flex items-center">
                                <i class="fas fa-filter text-purple-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-purple-700">Apenas Existentes</span>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Version Filters -->
                <div class="border-t border-gray-200 pt-6">
                    <h5 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-arrows-alt-v mr-2 text-gray-500"></i>Filtros de Versão
                    </h5>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-green-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showUp" class="mr-3 rounded text-green-600 focus:ring-green-500">
                            <div class="flex items-center">
                                <i class="fas fa-arrow-up text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-green-700">Update</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-red-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showDown" class="mr-3 rounded text-red-600 focus:ring-red-500">
                            <div class="flex items-center">
                                <i class="fas fa-arrow-down text-red-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-red-700">Downgrade</span>
                            </div>
                        </label>
                        <label class="flex items-center p-3 bg-white rounded-lg border border-gray-200 hover:border-yellow-300 transition-all duration-200 cursor-pointer group">
                            <input type="checkbox" x-model="filters.showEqual" class="mr-3 rounded text-yellow-600 focus:ring-yellow-500">
                            <div class="flex items-center">
                                <i class="fas fa-equals text-yellow-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-700 group-hover:text-yellow-700">Iguais</span>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="border-t border-gray-200 pt-6 mt-6">
                    <h5 class="text-sm font-semibold text-gray-700 mb-3 flex items-center">
                        <i class="fas fa-bolt mr-2 text-gray-500"></i>Ações Rápidas
                    </h5>
                    <div class="flex flex-wrap gap-2">
                        <button @click="selectAllFilters()" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg text-xs font-medium hover:bg-blue-200 transition-colors duration-200">
                            <i class="fas fa-check-square mr-1"></i>Selecionar Todos
                        </button>
                        <button @click="deselectAllFilters()" class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-200 transition-colors duration-200">
                            <i class="fas fa-square mr-1"></i>Desselecionar Todos
                        </button>
                        <button @click="selectOnlyChanges()" class="px-3 py-1 bg-green-100 text-green-700 rounded-lg text-xs font-medium hover:bg-green-200 transition-colors duration-200">
                            <i class="fas fa-exchange-alt mr-1"></i>Apenas Mudanças
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compare Button -->
            <div class="text-center mb-6">
                <button 
                    @click="compareJsons()"
                    class="px-8 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-all duration-200 font-semibold"
                >
                    <i class="fas fa-play mr-2"></i>Comparar Versões
                </button>
            </div>

            <!-- Comparison Results -->
            <div x-show="comparisonResults" x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 transform translate-y-4" x-transition:enter-end="opacity-100 transform translate-y-0" class="space-y-6">
                <!-- Statistics Summary -->
                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-chart-bar mr-2 text-blue-600"></i>Resumo das Mudanças
                    </h4>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center p-3 bg-green-50 rounded-lg border border-green-200">
                            <div class="text-2xl font-bold text-green-600" x-text="filteredResults.added.length"></div>
                            <div class="text-sm text-green-700">Adicionadas</div>
                        </div>
                        <div class="text-center p-3 bg-red-50 rounded-lg border border-red-200">
                            <div class="text-2xl font-bold text-red-600" x-text="filteredResults.removed.length"></div>
                            <div class="text-sm text-red-700">Removidas</div>
                        </div>
                        <div class="text-center p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                            <div class="text-2xl font-bold text-yellow-600" x-text="filteredResults.changed.length"></div>
                            <div class="text-sm text-yellow-700">Alteradas</div>
                        </div>
                        <div class="text-center p-3 bg-blue-50 rounded-lg border border-blue-200">
                            <div class="text-2xl font-bold text-blue-600" x-text="filteredResults.added.length + filteredResults.removed.length + filteredResults.changed.length"></div>
                            <div class="text-sm text-blue-700">Total</div>
                        </div>
                    </div>
                </div>

                <!-- Filter Info -->
                <div x-show="activeFilters.length > 0" class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                        <span class="text-sm text-blue-800">
                            <strong>Filtros ativos:</strong> <span x-text="activeFilters.join(', ')"></span>
                        </span>
                    </div>
                </div>

                <!-- Results -->
                <div x-show="filteredResults.added.length > 0" class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-green-800 mb-3">
                        <i class="fas fa-plus-circle mr-2"></i>Dependências Adicionadas
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg shadow-sm">
                            <thead class="bg-green-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-green-800">Dependência</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-green-800">Versão</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold text-green-800">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-green-200">
                                <template x-for="item in filteredResults.added" :key="item.key">
                                    <tr class="hover:bg-green-50 transition-colors duration-150">
                                        <td class="px-4 py-3 text-sm font-mono text-gray-800" x-text="item.key"></td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-800 font-semibold" x-text="item.version"></td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800 border border-green-200">
                                                NOVA
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div x-show="filteredResults.removed.length > 0" class="bg-red-50 border border-red-200 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-red-800 mb-3">
                        <i class="fas fa-minus-circle mr-2"></i>Dependências Removidas
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg shadow-sm">
                            <thead class="bg-red-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-red-800">Dependência</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-red-800">Versão</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold text-red-800">Status</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-red-200">
                                <template x-for="item in filteredResults.removed" :key="item.key">
                                    <tr class="hover:bg-red-50 transition-colors duration-150">
                                        <td class="px-4 py-3 text-sm font-mono text-gray-800" x-text="item.key"></td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-600" x-text="item.version"></td>
                                        <td class="px-4 py-3 text-center">
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-800 border border-red-200">
                                                REMOVIDA
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div x-show="filteredResults.changed.length > 0" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-yellow-800 mb-3">
                        <i class="fas fa-exchange-alt mr-2"></i>Versões Alteradas
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white rounded-lg shadow-sm">
                            <thead class="bg-yellow-100">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-800">Dependência</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-800">Versão Antiga</th>
                                    <th class="px-4 py-3 text-left text-sm font-semibold text-yellow-800">Versão Nova</th>
                                    <th class="px-4 py-3 text-center text-sm font-semibold text-yellow-800">Tipo de Mudança</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-yellow-200">
                                <template x-for="item in filteredResults.changed" :key="item.key">
                                    <tr class="hover:bg-yellow-50 transition-colors duration-150">
                                        <td class="px-4 py-3 text-sm font-mono text-gray-800" x-text="item.key"></td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-600" x-text="item.oldVersion"></td>
                                        <td class="px-4 py-3 text-sm font-mono text-gray-800 font-semibold" x-text="item.newVersion"></td>
                                        <td class="px-4 py-3 text-center">
                                            <span :class="getVersionBadgeClass(item.oldVersion, item.newVersion)" 
                                                  x-text="getVersionChangeType(item.oldVersion, item.newVersion)"
                                                  class="px-3 py-1 rounded-full text-xs font-semibold"></span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- No Changes Message -->
                <div x-show="!hasVisibleChanges && (results.added.length > 0 || results.removed.length > 0 || results.changed.length > 0)" class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
                    <i class="fas fa-search text-gray-400 text-2xl mb-2"></i>
                    <p class="text-gray-600">Nenhuma alteração visível com os filtros selecionados.</p>
                </div>

                <!-- No Changes at All -->
                <div x-show="results.added.length === 0 && results.removed.length === 0 && results.changed.length === 0" class="bg-gray-50 border border-gray-200 rounded-lg p-6 text-center">
                    <i class="fas fa-check-circle text-green-400 text-2xl mb-2"></i>
                    <p class="text-gray-600">Nenhuma alteração encontrada entre as versões.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        function mavenDependencies() {
            return {
                mavenUrl: '',
                loading: false,
                results: null,
                jsonOutput: '',
                jsonOld: '',
                jsonNew: '',
                comparisonResults: false,
                results: {
                    added: [],
                    removed: [],
                    changed: []
                },
                filters: {
                    showAdded: true,
                    showChanged: true,
                    showRemoved: true,
                    showOnlyExisting: false,
                    showUp: true,
                    showDown: true,
                    showEqual: true
                },

                get activeFilters() {
                    const filters = [];
                    if (this.filters.showOnlyExisting) filters.push('Apenas Existentes');
                    if (!this.filters.showAdded) filters.push('Sem Adições');
                    if (!this.filters.showChanged) filters.push('Sem Modificações');
                    if (!this.filters.showRemoved) filters.push('Sem Remoções');
                    if (!this.filters.showUp) filters.push('Sem Up');
                    if (!this.filters.showDown) filters.push('Sem Down');
                    if (!this.filters.showEqual) filters.push('Sem Iguais');
                    return filters;
                },

                get filteredResults() {
                    let added = this.results.added;
                    let removed = this.results.removed;
                    let changed = this.results.changed;

                    if (this.filters.showOnlyExisting) {
                        added = added.filter(item => this.depsOld.hasOwnProperty(item.key));
                        changed = changed.filter(item => this.depsOld.hasOwnProperty(item.key));
                        removed = removed.filter(item => this.depsOld.hasOwnProperty(item.key));
                    }

                    changed = changed.filter(item => {
                        const comparison = this.compareVersions(item.oldVersion, item.newVersion);
                        switch (comparison) {
                            case 'up': return this.filters.showUp;
                            case 'down': return this.filters.showDown;
                            case 'equal': return this.filters.showEqual;
                            default: return false;
                        }
                    });

                    return {
                        added: this.filters.showAdded ? added : [],
                        removed: this.filters.showRemoved ? removed : [],
                        changed: this.filters.showChanged ? changed : []
                    };
                },

                get hasVisibleChanges() {
                    return this.filteredResults.added.length > 0 || 
                           this.filteredResults.removed.length > 0 || 
                           this.filteredResults.changed.length > 0;
                },

                depsOld: {},
                depsNew: {},

                isValidUrl(url) {
                    return url.startsWith('https://mvnrepository.com/artifact/');
                },

                async fetchDependencies() {
                    if (!this.mavenUrl || !this.isValidUrl(this.mavenUrl)) {
                        this.showNotification('Por favor, insira uma URL válida do Maven Repository.', 'error');
                        return;
                    }

                    this.loading = true;
                    this.results = null;
                    this.jsonOutput = '';

                    const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(this.mavenUrl)}`;

                    try {
                        const response = await fetch(proxyUrl);
                        if (!response.ok) throw new Error(`Erro na rede: ${response.statusText}`);
                        
                        const data = await response.json();
                        const htmlContent = data.contents;
                        
                        if (!htmlContent) throw new Error('Não foi possível obter o conteúdo HTML da URL.');

                        const parser = new DOMParser();
                        const doc = parser.parseFromString(htmlContent, 'text/html');

                        const libraryIdentifier = [...doc.querySelectorAll('.breadcrumb a')]
                            .slice(-2)
                            .map(a => a.textContent.trim())
                            .concat(doc.querySelector('.version-header h2 a')?.textContent.trim() ?? '')
                            .join(':');

                        const dependencies = {};
                        const sections = doc.querySelectorAll('.version-section');
                        
                        sections.forEach(section => {
                            const table = section.querySelector('table.grid');
                            if (!table) return;
                            
                            const headerCells = table.querySelectorAll('thead th');
                            let artifactIndex = -1, versionIndex = -1;
                            
                            headerCells.forEach((th, index) => {
                                if (th.textContent.trim() === 'Group / Artifact') artifactIndex = index;
                                if (th.textContent.trim() === 'Version') versionIndex = index;
                            });
                            
                            if (artifactIndex === -1 || versionIndex === -1) return;
                            
                            const bodyRows = table.querySelectorAll('tbody tr');
                            bodyRows.forEach(row => {
                                const cells = row.querySelectorAll('td');
                                if (cells.length > Math.max(artifactIndex, versionIndex)) {
                                    const key = [...cells[artifactIndex].querySelectorAll('a')]
                                        .map(a => a.textContent.trim())
                                        .join(':');
                                    const version = cells[versionIndex].textContent.trim();
                                    if (key && version) dependencies[key] = version;
                                }
                            });
                        });

                        const sortedDependencies = {};
                        Object.keys(dependencies).sort().forEach(key => {
                            sortedDependencies[key] = dependencies[key];
                        });

                        this.jsonOutput = JSON.stringify(sortedDependencies, null, 2);
                        this.results = true;
                        this.showNotification('Dependências extraídas com sucesso!', 'success');

                    } catch (error) {
                        console.error('Erro ao buscar dependências:', error);
                        this.jsonOutput = JSON.stringify({ 
                            erro: 'Erro ao buscar dependências', 
                            detalhes: error.message 
                        }, null, 2);
                        this.results = true;
                        this.showNotification('Erro ao buscar dependências. Verifique a URL.', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                compareJsons() {
                    try {
                        this.depsOld = JSON.parse(this.jsonOld);
                        if (typeof this.depsOld !== 'object' || Array.isArray(this.depsOld) || this.depsOld === null) {
                            throw new Error("JSON antigo deve ser um objeto de dependências.");
                        }
                    } catch (e) {
                        this.showNotification(`Erro no JSON antigo: ${e.message}`, 'error');
                        return;
                    }

                    try {
                        this.depsNew = JSON.parse(this.jsonNew);
                        if (typeof this.depsNew !== 'object' || Array.isArray(this.depsNew) || this.depsNew === null) {
                            throw new Error("JSON novo deve ser um objeto de dependências.");
                        }
                    } catch (e) {
                        this.showNotification(`Erro no JSON novo: ${e.message}`, 'error');
                        return;
                    }

                    const added = [];
                    const removed = [];
                    const changed = [];

                    // Check for added or changed dependencies
                    for (const key in this.depsNew) {
                        if (this.depsOld.hasOwnProperty(key)) {
                            if (this.depsOld[key] !== this.depsNew[key]) {
                                changed.push({ key, oldVersion: this.depsOld[key], newVersion: this.depsNew[key] });
                            }
                        } else {
                            added.push({ key, version: this.depsNew[key] });
                        }
                    }

                    // Check for removed dependencies
                    for (const key in this.depsOld) {
                        if (!this.depsNew.hasOwnProperty(key)) {
                            removed.push({ key, version: this.depsOld[key] });
                        }
                    }

                    this.results = { added, removed, changed };
                    this.comparisonResults = true;
                    
                    const totalChanges = added.length + removed.length + changed.length;
                    this.showNotification(`Comparação concluída: ${totalChanges} alterações encontradas.`, 'success');
                },

                compareVersions(version1, version2) {
                    const normalizeVersion = (version) => {
                        const cleanVersion = version.replace(/[^\d.\-]/g, '');
                        return cleanVersion.split(/[.\-]/).map(num => {
                            const parsed = parseInt(num);
                            return isNaN(parsed) ? 0 : parsed;
                        });
                    };

                    const v1 = normalizeVersion(version1);
                    const v2 = normalizeVersion(version2);

                    const maxLength = Math.max(v1.length, v2.length);
                    for (let i = 0; i < maxLength; i++) {
                        const part1 = v1[i] || 0;
                        const part2 = v2[i] || 0;
                        
                        if (part1 > part2) return 'down';
                        if (part1 < part2) return 'up';
                    }
                    return 'equal';
                },

                getVersionIcon(version1, version2) {
                    const comparison = this.compareVersions(version1, version2);
                    switch (comparison) {
                        case 'up': return 'fas fa-arrow-up text-green-600';
                        case 'down': return 'fas fa-arrow-down text-red-600';
                        case 'equal': return 'fas fa-equals text-yellow-600';
                        default: return 'fas fa-equals text-yellow-600';
                    }
                },

                getVersionChangeType(version1, version2) {
                    const comparison = this.compareVersions(version1, version2);
                    switch (comparison) {
                        case 'up': return 'UPDATE';
                        case 'down': return 'DOWNGRADE';
                        case 'equal': return 'IGUAL';
                        default: return 'IGUAL';
                    }
                },

                getVersionBadgeClass(version1, version2) {
                    const comparison = this.compareVersions(version1, version2);
                    switch (comparison) {
                        case 'up': return 'bg-green-100 text-green-800 border border-green-200';
                        case 'down': return 'bg-red-100 text-red-800 border border-red-200';
                        case 'equal': return 'bg-yellow-100 text-yellow-800 border border-yellow-200';
                        default: return 'bg-gray-100 text-gray-800 border border-gray-200';
                    }
                },

                selectAllFilters() {
                    this.filters.showAdded = true;
                    this.filters.showChanged = true;
                    this.filters.showRemoved = true;
                    this.filters.showUp = true;
                    this.filters.showDown = true;
                    this.filters.showEqual = true;
                    this.showNotification('Todos os filtros foram selecionados!', 'success');
                },

                deselectAllFilters() {
                    this.filters.showAdded = false;
                    this.filters.showChanged = false;
                    this.filters.showRemoved = false;
                    this.filters.showUp = false;
                    this.filters.showDown = false;
                    this.filters.showEqual = false;
                    this.showNotification('Todos os filtros foram desselecionados!', 'info');
                },

                selectOnlyChanges() {
                    this.filters.showAdded = true;
                    this.filters.showChanged = true;
                    this.filters.showRemoved = true;
                    this.filters.showUp = true;
                    this.filters.showDown = true;
                    this.filters.showEqual = false;
                    this.showNotification('Filtros configurados para mostrar apenas mudanças!', 'success');
                },

                swapJsons() {
                    const temp = this.jsonOld;
                    this.jsonOld = this.jsonNew;
                    this.jsonNew = temp;
                    
                    // Limpar resultados da comparação anterior
                    this.comparisonResults = false;
                    this.results = {
                        added: [],
                        removed: [],
                        changed: []
                    };
                    
                    this.showNotification('JSONs trocados com sucesso!', 'success');
                },

                copyToClipboard() {
                    navigator.clipboard.writeText(this.jsonOutput).then(() => {
                        this.showNotification('JSON copiado para a área de transferência!', 'success');
                    }).catch(err => {
                        console.error('Falha ao copiar:', err);
                        this.showNotification('Erro ao copiar para a área de transferência.', 'error');
                    });
                },

                copyToField(field) {
                    if (field === 'old') {
                        this.jsonOld = this.jsonOutput;
                    } else {
                        this.jsonNew = this.jsonOutput;
                    }
                    this.showNotification(`JSON copiado para o campo ${field === 'old' ? 'antigo' : 'novo'}!`, 'success');
                    
                    // Scroll to comparator
                    setTimeout(() => {
                        document.querySelector('#jsonOld').scrollIntoView({ behavior: 'smooth' });
                    }, 100);
                },

                clearResults() {
                    this.results = null;
                    this.jsonOutput = '';
                    this.mavenUrl = '';
                },

                showNotification(message, type = 'info') {
                    // Create notification element
                    const notification = document.createElement('div');
                    notification.className = `fixed top-4 right-4 z-50 px-6 py-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-full`;
                    
                    const bgColor = type === 'success' ? 'bg-green-500' : 
                                  type === 'error' ? 'bg-red-500' : 'bg-blue-500';
                    
                    notification.className += ` ${bgColor} text-white`;
                    notification.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
                            <span>${message}</span>
                            <button class="ml-4 text-white hover:text-gray-200" onclick="this.parentElement.parentElement.remove()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                    
                    document.body.appendChild(notification);
                    
                    // Animate in
                    setTimeout(() => {
                        notification.classList.remove('translate-x-full');
                    }, 100);
                    
                    // Auto remove after 5 seconds
                    setTimeout(() => {
                        notification.classList.add('translate-x-full');
                        setTimeout(() => notification.remove(), 300);
                    }, 5000);
                }
            }
        }
    </script>
</body>
</html>
